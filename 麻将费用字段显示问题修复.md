# éº»å°†è´¹ç”¨å­—æ®µæ˜¾ç¤ºé—®é¢˜ä¿®å¤

## ğŸ”´ é—®é¢˜æè¿°

éº»å°†è®°å½•ä¸æ˜¾ç¤ºå°è´¹ã€æ‰“è½¦è´¹ã€çƒŸé’±è¿™å‡ ä¸ªå­—æ®µçš„æ•°æ®ã€‚

## ğŸ¯ é—®é¢˜åŸå› 

åç«¯æ§åˆ¶å™¨åœ¨åˆ›å»ºå’Œæ›´æ–°è®°å½•æ—¶ï¼Œæ²¡æœ‰æ¥æ”¶å’Œå¤„ç†è¿™äº›æ–°å­—æ®µï¼š
- âŒ `table_fee`ï¼ˆå°è´¹ï¼‰
- âŒ `taxi_fee`ï¼ˆæ‰“è½¦è´¹ï¼‰
- âŒ `cigarette_fee`ï¼ˆçƒŸé’±ï¼‰

è™½ç„¶ï¼š
- âœ… æ•°æ®åº“è¡¨æœ‰è¿™äº›å­—æ®µ
- âœ… å‰ç«¯è¡¨å•å‘é€è¿™äº›å­—æ®µ
- âœ… æ¨¡å‹æ”¯æŒè¯»å†™è¿™äº›å­—æ®µ

**ä½†æ˜¯æ§åˆ¶å™¨æ²¡æœ‰ä»è¯·æ±‚ä¸­æå–è¿™äº›å­—æ®µï¼**

## âœ… å·²ä¿®å¤

### ä¿®æ”¹æ–‡ä»¶ï¼š`controllers/mahjongController.js`

#### 1. åˆ›å»ºè®°å½•æ–¹æ³•
```javascript
// ä¿®å¤å‰
const { game_date, game_time, players, scores, win_amount, game_type, location, notes } = req.body;

// ä¿®å¤å âœ…
const { game_date, game_time, players, scores, win_amount, table_fee, taxi_fee, cigarette_fee, game_type, location, notes } = req.body;

// ä¼ é€’ç»™æ¨¡å‹
MahjongRecord.create({
  user_id,
  game_date,
  game_time: game_time || null,
  players,
  scores,
  win_amount,
  table_fee: table_fee || 0,      // âœ… æ–°å¢
  taxi_fee: taxi_fee || 0,        // âœ… æ–°å¢
  cigarette_fee: cigarette_fee || 0, // âœ… æ–°å¢
  game_type: game_type || null,
  location: location || null,
  notes: notes || null
});
```

#### 2. æ›´æ–°è®°å½•æ–¹æ³•
```javascript
// ä¿®å¤å‰
const { game_date, game_time, players, scores, win_amount, game_type, location, notes } = req.body;

// ä¿®å¤å âœ…
const { game_date, game_time, players, scores, win_amount, table_fee, taxi_fee, cigarette_fee, game_type, location, notes } = req.body;

// ä¼ é€’ç»™æ¨¡å‹
MahjongRecord.update(id, user_id, {
  game_date,
  game_time: game_time || null,
  players,
  scores,
  win_amount,
  table_fee: table_fee || 0,      // âœ… æ–°å¢
  taxi_fee: taxi_fee || 0,        // âœ… æ–°å¢
  cigarette_fee: cigarette_fee || 0, // âœ… æ–°å¢
  game_type: game_type || null,
  location: location || null,
  notes: notes || null
});
```

## ğŸ”„ éœ€è¦æ“ä½œ

### 1. é‡å¯åç«¯æœåŠ¡å™¨
æ§åˆ¶å™¨ä»£ç å·²æ›´æ–°ï¼Œéœ€è¦é‡å¯åç«¯ï¼š

```bash
# Windows PowerShell
# å…ˆåœæ­¢ç°æœ‰è¿›ç¨‹
taskkill /F /IM node.exe

# é‡æ–°å¯åŠ¨
npm start
```

æˆ–åœ¨è¿è¡Œåç«¯çš„ç»ˆç«¯çª—å£ï¼š
```bash
# æŒ‰ Ctrl+C åœæ­¢
# ç„¶åé‡æ–°å¯åŠ¨
npm start
```

### 2. åˆ·æ–°å‰ç«¯é¡µé¢
```bash
Ctrl + Shift + R  # å¼ºåˆ¶åˆ·æ–°
```

### 3. æµ‹è¯•æ·»åŠ æ–°è®°å½•
```
æ—¥æœŸï¼š2025-12-03
ç›ˆäºï¼š+100
å°è´¹ï¼š20
æ‰“è½¦è´¹ï¼š30
çƒŸé’±ï¼š50
```

ç‚¹å‡»"ä¿å­˜"åï¼Œåº”è¯¥èƒ½åœ¨è¡¨æ ¼ä¸­çœ‹åˆ°æ‰€æœ‰è´¹ç”¨ã€‚

## ğŸ“Š éªŒè¯æ•°æ®

### æŸ¥çœ‹ç°æœ‰è®°å½•
ç°æœ‰è®°å½•çš„è¿™äº›å­—æ®µå€¼ä¸º 0ï¼š

```javascript
{
  "table_fee": 0,
  "taxi_fee": 0,
  "cigarette_fee": 0
}
```

**è¿™æ˜¯æ­£å¸¸çš„ï¼** å› ä¸ºè¿™äº›æ˜¯åæ¥æ·»åŠ çš„å­—æ®µï¼Œé»˜è®¤å€¼å°±æ˜¯ 0ã€‚

### æŸ¥çœ‹æ–°è®°å½•
ä¿®å¤åæ·»åŠ çš„è®°å½•åº”è¯¥æ­£ç¡®æ˜¾ç¤ºï¼š

| æ—¥æœŸ | ç›ˆäº | å°è´¹ | æ‰“è½¦è´¹ | çƒŸé’± | æ“ä½œ |
|------|------|------|--------|------|------|
| 2025-12-03 | +Â¥100.00 | Â¥20.00 | Â¥30.00 | Â¥50.00 | ç¼–è¾‘ åˆ é™¤ |

## ğŸ” è°ƒè¯•æ£€æŸ¥

### 1. æ£€æŸ¥åç«¯æ—¥å¿—
é‡å¯åç«¯åï¼Œåœ¨ç»ˆç«¯åº”è¯¥çœ‹åˆ°ï¼š
```
å·²æ³¨å†Œè·¯ç”±:
  - /api/mahjong/...
æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000
```

### 2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
æ‰“å¼€ F12 â†’ Network æ ‡ç­¾ï¼Œæ·»åŠ è®°å½•æ—¶æŸ¥çœ‹è¯·æ±‚ï¼š

**Request Payload åº”è¯¥åŒ…å«ï¼š**
```json
{
  "game_date": "2025-12-03",
  "game_time": "",
  "players": ["æˆ‘"],
  "scores": [0],
  "win_amount": 100,
  "table_fee": 20,
  "taxi_fee": 30,
  "cigarette_fee": 50,
  "game_type": "",
  "location": "",
  "notes": ""
}
```

**Response åº”è¯¥æ˜¯ï¼š**
```json
{
  "success": true,
  "message": "åˆ›å»ºè®°å½•æˆåŠŸ",
  "data": {
    "id": 4
  }
}
```

### 3. æ£€æŸ¥è¿”å›çš„è®°å½•
GET /api/mahjong åº”è¯¥è¿”å›åŒ…å«è¿™äº›å­—æ®µçš„è®°å½•ï¼š

```json
{
  "id": 4,
  "user_id": 1,
  "game_date": "2025-12-03",
  "win_amount": 100,
  "table_fee": 20,
  "taxi_fee": 30,
  "cigarette_fee": 50,
  ...
}
```

## ğŸ’¡ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

### å¼€å‘æµç¨‹é—®é¢˜
1. âœ… æ•°æ®åº“å­—æ®µæ·»åŠ æˆåŠŸ
2. âœ… æ¨¡å‹æ–¹æ³•æ›´æ–°æˆåŠŸ
3. âœ… å‰ç«¯è¡¨å•å‘é€æ•°æ®æˆåŠŸ
4. âŒ **ä½†å¿˜è®°æ›´æ–°æ§åˆ¶å™¨æ¥æ¥æ”¶è¿™äº›å­—æ®µï¼**

### æ•°æ®æµåˆ†æ
```
å‰ç«¯è¡¨å•
  â†“ å‘é€: { table_fee: 20, taxi_fee: 30, cigarette_fee: 50 }
æ§åˆ¶å™¨ï¼ˆä¿®å¤å‰ï¼‰
  â†“ æ¥æ”¶: æ²¡æœ‰æå–è¿™äº›å­—æ®µ âŒ
  â†“ ä¼ é€’: { win_amount: 100 } (ç¼ºå°‘è´¹ç”¨å­—æ®µ)
æ¨¡å‹
  â†“ æ’å…¥: table_fee=0, taxi_fee=0, cigarette_fee=0 (ä½¿ç”¨é»˜è®¤å€¼)
æ•°æ®åº“
  âœ“ å­˜å‚¨: è´¹ç”¨éƒ½æ˜¯ 0
```

### ä¿®å¤åçš„æ•°æ®æµ
```
å‰ç«¯è¡¨å•
  â†“ å‘é€: { table_fee: 20, taxi_fee: 30, cigarette_fee: 50 }
æ§åˆ¶å™¨ï¼ˆä¿®å¤åï¼‰
  â†“ æ¥æ”¶: âœ… æå–è¿™äº›å­—æ®µ
  â†“ ä¼ é€’: { win_amount: 100, table_fee: 20, taxi_fee: 30, cigarette_fee: 50 }
æ¨¡å‹
  â†“ æ’å…¥: table_fee=20, taxi_fee=30, cigarette_fee=50
æ•°æ®åº“
  âœ“ å­˜å‚¨: è´¹ç”¨æ­£ç¡®ä¿å­˜ âœ…
```

## âœ… å®Œæ•´ä¿®å¤æ¸…å•

- [x] æ•°æ®åº“å­—æ®µæ·»åŠ ï¼ˆå·²å®Œæˆï¼‰
- [x] æ¨¡å‹ create() æ–¹æ³•æ›´æ–°ï¼ˆå·²å®Œæˆï¼‰
- [x] æ¨¡å‹ update() æ–¹æ³•æ›´æ–°ï¼ˆå·²å®Œæˆï¼‰
- [x] å‰ç«¯è¡¨å•å‘é€å­—æ®µï¼ˆå·²å®Œæˆï¼‰
- [x] å‰ç«¯è¡¨æ ¼æ˜¾ç¤ºå­—æ®µï¼ˆå·²å®Œæˆï¼‰
- [x] **æ§åˆ¶å™¨ createRecord() æ¥æ”¶å­—æ®µ**ï¼ˆåˆšä¿®å¤ï¼‰âœ…
- [x] **æ§åˆ¶å™¨ updateRecord() æ¥æ”¶å­—æ®µ**ï¼ˆåˆšä¿®å¤ï¼‰âœ…

## ğŸ‰ æ€»ç»“

### é—®é¢˜
- âŒ æ§åˆ¶å™¨æ²¡æœ‰æ¥æ”¶è´¹ç”¨å­—æ®µ
- âŒ å¯¼è‡´è´¹ç”¨æ•°æ®æ— æ³•ä¿å­˜

### è§£å†³
- âœ… æ›´æ–°æ§åˆ¶å™¨æå–è´¹ç”¨å­—æ®µ
- âœ… æ­£ç¡®ä¼ é€’ç»™æ¨¡å‹ä¿å­˜

### ç»“æœ
- âœ… ç°åœ¨å¯ä»¥æ­£ç¡®ä¿å­˜å’Œæ˜¾ç¤ºè´¹ç”¨äº†
- âœ… æ–°è®°å½•ä¼šæ˜¾ç¤ºæ­£ç¡®çš„è´¹ç”¨é‡‘é¢

---

**é‡å¯åç«¯æœåŠ¡å™¨åï¼Œè´¹ç”¨å­—æ®µå°±èƒ½æ­£å¸¸æ˜¾ç¤ºäº†ï¼** ğŸŠ

## ğŸš€ ç«‹å³æµ‹è¯•

1. é‡å¯åç«¯ï¼š`Ctrl+C` ç„¶å `npm start`
2. åˆ·æ–°å‰ç«¯ï¼š`Ctrl + Shift + R`
3. æ·»åŠ æ–°è®°å½•å¹¶å¡«å†™è´¹ç”¨
4. ä¿å­˜åæŸ¥çœ‹è¡¨æ ¼ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰è´¹ç”¨ï¼

æˆåŠŸåæ‚¨ä¼šçœ‹åˆ°å®Œæ•´çš„è´¹ç”¨è®°å½•ï¼âœ¨

