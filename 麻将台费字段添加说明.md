# 麻将记录台费字段添加说明

## ✅ 已完成的修改

### 1. 数据库字段添加
在 `mahjong_records` 表中添加了 `table_fee` 字段：

```sql
ALTER TABLE mahjong_records 
ADD COLUMN table_fee DECIMAL(10, 2) DEFAULT 0;
```

**字段说明：**
- 字段名：`table_fee`（台费）
- 类型：`DECIMAL(10, 2)`（最多10位数，2位小数）
- 默认值：`0`
- 可选字段

### 2. 后端模型更新
**文件：** `models/MahjongRecord.js`

**修改点：**
- ✅ `create()` 方法：添加 table_fee 字段插入
- ✅ `update()` 方法：添加 table_fee 字段更新
- ✅ 默认值处理：`data.table_fee || 0`

```javascript
// 创建记录
INSERT INTO mahjong_records 
(user_id, game_date, game_time, players, scores, win_amount, table_fee, ...)
VALUES (?, ?, ?, ?, ?, ?, ?, ...)

// 更新记录
UPDATE mahjong_records 
SET game_date = ?, 
    game_time = ?, 
    players = ?, 
    scores = ?, 
    win_amount = ?, 
    table_fee = ?,
    ...
WHERE id = ? AND user_id = ?
```

### 3. 前端表单更新
**文件：** `frontend/src/pages/Mahjong.js`

**表单字段：**
```javascript
const [formData, setFormData] = useState({
  game_date: new Date().toISOString().split('T')[0],
  win_amount: '',
  table_fee: ''  // 新增
});
```

**表单UI：**
```jsx
<div className="form-group">
  <label>台费</label>
  <input
    type="number"
    step="0.01"
    min="0"
    placeholder="输入台费，如 20"
    value={formData.table_fee}
    onChange={(e) => setFormData({ ...formData, table_fee: e.target.value })}
  />
</div>
```

### 4. 前端表格显示更新
**表格列：**

| 日期 | 盈亏 | 台费 | 操作 |
|------|------|------|------|
| 2025-12-03 | +¥150.00 | ¥20.00 | 编辑 删除 |
| 2025-12-02 | -¥80.00 | ¥20.00 | 编辑 删除 |

**新增列：**
```jsx
<th>台费</th>

<td>
  <span className="table-fee">
    ¥{(record.table_fee || 0).toFixed(2)}
  </span>
</td>
```

### 5. CSS 样式添加
**文件：** `frontend/src/pages/Mahjong.css`

```css
.table-fee {
  color: #666;
  font-size: 14px;
}
```

## 📊 数据结构

### 表单数据（前端）
```javascript
{
  game_date: '2025-12-03',    // 必填
  win_amount: 150,             // 必填
  table_fee: 20                // 可选，默认0
}
```

### 提交到后端的完整数据
```javascript
{
  game_date: '2025-12-03',
  game_time: '',
  players: ['我'],
  scores: [0],
  win_amount: 150,
  table_fee: 20,              // 新增
  game_type: '',
  location: '',
  notes: ''
}
```

### 数据库存储
```javascript
{
  id: 1,
  user_id: 1,
  game_date: '2025-12-03',
  game_time: '',
  players: '["我"]',
  scores: '[0]',
  win_amount: 150.00,
  table_fee: 20.00,           // 新增
  game_type: '',
  location: '',
  notes: '',
  created_at: '2025-12-03 12:00:00',
  updated_at: '2025-12-03 12:00:00'
}
```

## 🚀 使用说明

### 添加记录示例

**场景1：有台费**
```
日期：2025-12-03
盈亏：+100（赢了100）
台费：20（每人台费）
```

**场景2：无台费**
```
日期：2025-12-03
盈亏：-50（输了50）
台费：（留空或填0）
```

### 表单字段说明

1. **游戏日期** *（必填）
   - 默认：今天
   - 格式：YYYY-MM-DD

2. **盈亏金额** *（必填）
   - 正数：赢钱（如：+100）
   - 负数：输钱（如：-50）

3. **台费**（可选）
   - 默认：0
   - 说明：打麻将的场地费用
   - 示例：20、30、50 等

## 💡 使用场景

### 场景1：有台费的麻将
```
在麻将馆打牌：
- 赢了150元
- 支付台费20元
- 净收入 = 150 - 20 = 130元

记录：
日期：2025-12-03
盈亏：+150
台费：20
```

### 场景2：朋友家打牌（无台费）
```
在朋友家打牌：
- 输了80元
- 无台费

记录：
日期：2025-12-03
盈亏：-80
台费：（留空）
```

## 📊 统计说明

台费字段暂时只用于记录，不参与统计计算。

**当前统计：**
- 总盈亏 = win_amount 的总和
- 台费单独显示，可以查看总台费支出

**未来可扩展：**
- 净盈亏 = 总盈亏 - 总台费
- 台费统计分析
- 台费趋势图

## ✅ 验证表字段

已确认表字段包含：
```
✅ 更新后的表字段:
  - id
  - user_id
  - game_date
  - game_time
  - players
  - scores
  - win_amount
  - game_type
  - location
  - notes
  - created_at
  - updated_at
  - table_fee         ← 新增
```

## 🔄 向后兼容

### 已有数据
- ✅ 旧记录的 `table_fee` 字段自动为 `0`
- ✅ 不影响现有记录的显示
- ✅ 可以编辑旧记录添加台费

### 数据迁移
不需要手动迁移，ALTER TABLE 已自动为所有现有记录设置 `table_fee = 0`

## 🎯 注意事项

1. **台费是可选的**
   - 不填写时默认为 0
   - 不影响必填字段验证

2. **台费不能为负数**
   - 表单设置了 `min="0"`
   - 只能输入 0 或正数

3. **台费精确到分**
   - 支持小数，如：20.5
   - 显示时保留2位小数

4. **台费独立记录**
   - 不自动从盈亏金额中扣除
   - 需要单独记录和显示

## 📱 界面展示

### 表单（3个字段）
```
┌─────────────────────────────────┐
│ 添加记录                        │
├─────────────────────────────────┤
│ 游戏日期 *  [2025-12-03]       │
│                                 │
│ 盈亏金额 *  [+100]              │
│ (正数为赢，负数为输)            │
│                                 │
│ 台费        [20]                │
│                                 │
│         [取消]  [保存]          │
└─────────────────────────────────┘
```

### 表格（4列）
```
┌────────────┬────────────┬─────────┬────────┐
│ 日期       │ 盈亏       │ 台费    │ 操作   │
├────────────┼────────────┼─────────┼────────┤
│ 2025-12-03 │ +¥150.00   │ ¥20.00  │ 编辑 删除│
│ 2025-12-02 │ -¥80.00    │ ¥20.00  │ 编辑 删除│
│ 2025-12-01 │ +¥200.00   │ ¥0.00   │ 编辑 删除│
└────────────┴────────────┴─────────┴────────┘
```

## 🎉 总结

### 改进内容
- ✅ 数据库添加 `table_fee` 字段
- ✅ 后端模型支持台费读写
- ✅ 前端表单添加台费输入
- ✅ 表格显示台费列
- ✅ 样式优化
- ✅ 向后兼容

### 用户体验
- 🎯 可选字段，灵活使用
- 💡 清晰展示，一目了然
- 🚀 不影响现有功能

---

**麻将记录现在支持台费记录了！** 🎊

## 🔄 下一步

刷新浏览器页面即可使用新功能：
```
Ctrl + Shift + R (强制刷新)
```

开始记录带台费的麻将战绩吧！🀄

